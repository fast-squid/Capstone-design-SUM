<!DOCTYPE html>
<html>
<head>
<style>
.dropbtn {
    background-color: #FFFFFF;
    color: black;
    padding: 16px;
    font-size: 16px;
    border: none;
}


.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: relative;
    background-color: #f1f1f1;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

.dropdown-content li {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
    border: 2px #555555;
}

.dropdown-content li:hover {background-color: #ddd;}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #AAAAAA;
}
</style>
<!-- <script type="text/javascript" src="https://www.google.com/jsapi"></script> -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    function loadData(interval) {
        var request = new XMLHttpRequest();
        var url = "http://ec2-13-209-19-156.ap-northeast-2.compute.amazonaws.com:3000/view?cnt=" + String(interval)
        request.open("GET", url, true);
        request.send(null);

        var temperature = [['time', 'temperature']]
        var co2 = [['time', 'co2']]
        var pm10 = [['time', 'pm10']]
        var pm25 = [['time', 'pm25']]
        var humidity = [['time', 'humidity']]

        console.log(request)
        request.onreadystatechange = function(){
            console.log(request.getAllResponseHeaders())
            if(this.readyState == 4 && this.status == 200){
                var rowData = request.getResponseHeader("Data");
                rowData = JSON.parse(rowData);
                for(key in rowData){
                    for(property in rowData[key]){
                        temperature.push([property, rowData[key][property][0]]);
                        co2.push([property, rowData[key][property][1]]);
                        pm10.push([property, rowData[key][property][2]]);
                        pm25.push([property, rowData[key][property][3]]);
                        humidity.push([property, rowData[key][property][4]]);
                    }
                }
            }
        }

        // trouble shooting here -> dlwjdaud 
        google.charts.load('current', {packages:["corechart"]}); 

        google.charts.setOnLoadCallback(function() {
            console.log("setOnLoadCallback join..");
            
            drawChart(co2, 'co2', 'chart_co2');
            drawChart(humidity, 'humidity', 'chart_humidity');
        });

        function drawChart(Data, name, id) {
            var data = google.visualization.arrayToDataTable(Data);
            console.log(data);

            var options = {
                title: name
            };

            var chart = new google.visualization.LineChart(document.getElementById(id));
            chart.draw(data, options);
        }
    }
</script>
</head>
<body>
<div class="dropdown">
<button class="dropbtn"> view </button>
<div class="dropdown-content">
    <li onclick="loadData(1);" style="cursor:pointer;"> 1 minute </li>
    <li onclick="loadData(10);"; style="cursor:pointer;"> 10 minute </li>
    <li onclick="loadData(60);" style="cursor:pointer;"> 1 hour </li>
</div>
<div id="chart_co2" style="width: 900px; height: 500px;"></div>
<div id="chart_humidity" style="width: 900px; height: 500px;"></div>
</body>
</html>
